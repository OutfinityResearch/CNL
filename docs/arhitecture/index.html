<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CNL-PL Architecture</title>
  <meta name="description" content="Architecture overview for the CNL-PL parser, validation, and pragmatic engines." />
  <link rel="stylesheet" href="../assets/style.css" />
</head>
<body>
  <div class="page">
    <header class="site-header">
      <div class="header-inner">
        <div class="brand">
          <div class="brand-mark" aria-hidden="true"></div>
          <div>
            <div>CNL Programming Language</div>
            <small>Controlled Natural Language for Executable Meaning</small>
          </div>
        </div>
        <nav class="nav">
          <a href="../">Home</a>
          <a href="../theory/">Theory</a>
          <a class="active" href="./">Architecture</a>
          <a href="../wiki/">Wiki</a>
          <a href="../syntax/">Syntax</a>
          <a href="../specs/">Specs</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="hero">
        <div>
          <span class="tag">Architecture</span>
          <h1>From plain text to executable meaning.</h1>
          <p>
            The CNL-PL stack follows a deterministic pipeline: lexical analysis, parsing, validation,
            AST normalization, and pragmatic execution.
          </p>
        </div>
      </section>

      <section class="section">
        <h2>The Pipeline</h2>
        <p>Data flows strictly in one direction: from text to AST, then to IR (Intermediate Representation) or direct execution.</p>
        
        <div class="diagram-container">
          <svg viewBox="0 0 800 200" xmlns="http://www.w3.org/2000/svg" style="font-family: sans-serif; width: 100%; max-width: 800px;">
             <!-- Definitions for markers -->
            <defs>
              <marker id="arrowhead-pipe" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
              </marker>
            </defs>

            <!-- Top Row: Input -> Lexer -> Parser -->
            <g transform="translate(50, 40)">
              <!-- Input -->
              <rect x="0" y="0" width="120" height="60" rx="4" ry="4" fill="#fff" stroke="#94a3b8" stroke-width="2"/>
              <text x="60" y="25" text-anchor="middle" font-weight="bold" fill="#334155">Input</text>
              <text x="60" y="45" text-anchor="middle" font-size="12" fill="#64748b">(CNL Text)</text>
              
              <!-- Arrow -->
              <line x1="120" y1="30" x2="180" y2="30" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead-pipe)"/>
              
              <!-- Lexer -->
              <rect x="180" y="0" width="120" height="60" rx="4" ry="4" fill="#fff" stroke="#94a3b8" stroke-width="2"/>
              <text x="240" y="25" text-anchor="middle" font-weight="bold" fill="#334155">Lexer</text>
              <text x="240" y="45" text-anchor="middle" font-size="12" fill="#64748b">(Tokens)</text>
              
              <!-- Arrow -->
              <line x1="300" y1="30" x2="360" y2="30" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead-pipe)"/>

              <!-- Parser -->
              <rect x="360" y="0" width="120" height="60" rx="4" ry="4" fill="#fff" stroke="#94a3b8" stroke-width="2"/>
              <text x="420" y="25" text-anchor="middle" font-weight="bold" fill="#334155">Parser</text>
              <text x="420" y="45" text-anchor="middle" font-size="12" fill="#64748b">(AST)</text>
            </g>

            <!-- Downward connection from Parser to Validator -->
             <path d="M 470 100 L 470 130" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead-pipe)" fill="none"/>

            <!-- Bottom Row: Engine <- Compiler <- Validator -->
            <g transform="translate(50, 130)">
              <!-- Engine -->
              <rect x="0" y="0" width="120" height="60" rx="4" ry="4" fill="#f0f9ff" stroke="#0ea5e9" stroke-width="2"/>
              <text x="60" y="25" text-anchor="middle" font-weight="bold" fill="#0369a1">Engine</text>
              <text x="60" y="45" text-anchor="middle" font-size="12" fill="#0284c7">(Execution)</text>
              
              <!-- Arrow (Right to Left) -->
              <line x1="180" y1="30" x2="120" y2="30" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead-pipe)"/>

              <!-- Compiler -->
              <rect x="180" y="0" width="120" height="60" rx="4" ry="4" fill="#fff" stroke="#94a3b8" stroke-width="2"/>
              <text x="240" y="25" text-anchor="middle" font-weight="bold" fill="#334155">Compiler</text>
              <text x="240" y="45" text-anchor="middle" font-size="12" fill="#64748b">(Plan/KB)</text>
              
              <!-- Arrow (Right to Left) -->
              <line x1="360" y1="30" x2="300" y2="30" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead-pipe)"/>

              <!-- Validator -->
              <rect x="360" y="0" width="120" height="60" rx="4" ry="4" fill="#fff" stroke="#94a3b8" stroke-width="2"/>
              <text x="420" y="25" text-anchor="middle" font-weight="bold" fill="#334155">Validator</text>
              <text x="420" y="45" text-anchor="middle" font-size="12" fill="#64748b">(Errors)</text>
            </g>
          </svg>
        </div>
      </section>

      <section class="section">
        <h2>Subsystems Detail</h2>
        <div class="grid">
          <article class="card">
            <h3>1. Lexer & Parser</h3>
            <p>
              The lexer handles tokenization with "longest-match" rules for multi-word keywords. 
              The parser builds a lossless AST where every boolean group is explicit.
            </p>
          </article>
          <article class="card">
            <h3>2. Validator</h3>
            <p>
              Checks for semantic correctness before execution.
              <br/><em>Example: ensuring all variables in a rule are bound.</em>
            </p>
          </article>
          <article class="card">
            <h3>3. Compiler (AST -> KB)</h3>
            <p>
              Transforms the AST into a "Compiled Knowledge Base" (DS09). 
              This uses <strong>Bitsets</strong> and <strong>Interning</strong> (DS08) for maximum performance.
            </p>
          </article>
          <article class="card">
            <h3>4. Pragmatics Engine</h3>
            <p>
              The runtime that executes the user's intent. It can invoke a Solver (CSP), a Planner (Action graph), or a Proof engine (Deduction).
            </p>
          </article>
        </div>
      </section>

      <section class="section">
        <h2>Storage Model</h2>
        <p>
          CNL-PL does not use a traditional SQL database. It uses an in-memory, bitset-oriented 
          graph structure defined in <strong>DS09</strong>.
        </p>
        <ul class="list">
          <li><strong>Entities</strong> are dense integers (0..N).</li>
          <li><strong>Relations</strong> are stored as bit matrices for O(1) checks.</li>
          <li><strong>Attributes</strong> use column-oriented arrays (float64/int32).</li>
        </ul>
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-inner">
        <div>Vision: CNL Programming Language - Deterministic by design</div>
        <div class="footer-links">
          <a href="../">Home</a>
          <a href="../specs/">Specs</a>
          <a href="../wiki/">Wiki</a>
        </div>
      </div>
    </footer>
  </div>
</body>
</html>
